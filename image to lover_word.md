#  ä¸€ã€ç®€ä»‹

æ ¹æ®ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæƒ…è¯ï¼Œæ”¹ç¼–è‡ªAI Studioé¡¹ç›®ï¼šhttps://aistudio.baidu.com/aistudio/projectdetail/738634

å°ç‹å–œæ¬¢æ—…æ¸¸ï¼Œèµ°éäº†å¤§æ±Ÿå—åŒ—ï¼Œçœ‹äº†ä¸å°‘ç¾æ™¯ï¼Œå½“ç„¶ç¾æ™¯æ—å¾€å¾€ä¹Ÿæœ‰å¾ˆå¤šç¾å¥³ï¼Œä½†æ˜¯å› ä¸ºå˜´å¾ˆç¬¨ä¸€ç›´ä¹Ÿä¸æ•¢æ­è®ªï¼Œæ‰€ä»¥æ¯èƒSOLOåˆ°ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å¸®åŠ©ä¸€ä¸‹ä»–å§

å°ç™½åˆå…¥é—¨ï¼Œè°¢è°¢çš„å¤§å®¶æ‰¹è¯„æŒ‡æ­£

æœ¬é¡¹ç›®é€šè¿‡AI Studio(åŸºäºç™¾åº¦æ·±åº¦å­¦ä¹ å¹³å°é£æ¡¨çš„äººå·¥æ™ºèƒ½å­¦ä¹ ä¸å®è®­ç¤¾åŒºï¼Œæä¾›åœ¨çº¿ç¼–ç¨‹ç¯å¢ƒã€å…è´¹GPUç®—åŠ›ã€æµ·é‡å¼€æºç®—æ³•å’Œå¼€æ”¾æ•°æ®ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿåˆ›å»ºå’Œéƒ¨ç½²æ¨¡å‹)è¿è¡Œã€‚

æœ¬é¡¹ç›®AI Studioé¡¹ç›®åœ°å€ï¼šhttps://aistudio.baidu.com/aistudio/projectdetail/757031

## PaddleHubç®€ä»‹

PaddleHubæ˜¯é£æ¡¨ç”Ÿæ€çš„é¢„è®­ç»ƒæ¨¡å‹åº”ç”¨å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥ä¾¿æ·åœ°ä½¿ç”¨é«˜è´¨é‡çš„é¢„è®­ç»ƒæ¨¡å‹ç»“åˆFine-tune APIå¿«é€Ÿå®Œæˆæ¨¡å‹è¿ç§»åˆ°éƒ¨ç½²çš„å…¨æµç¨‹å·¥ä½œã€‚PaddleHubæä¾›çš„é¢„è®­ç»ƒæ¨¡å‹æ¶µç›–äº†å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯æ³•åˆ†æã€è¯­ä¹‰æ¨¡å‹ã€æƒ…æ„Ÿåˆ†æã€è§†é¢‘åˆ†ç±»ã€å›¾åƒç”Ÿæˆã€å›¾åƒåˆ†å‰²ã€æ–‡æœ¬å®¡æ ¸ã€å…³é”®ç‚¹æ£€æµ‹ç­‰ä¸»æµæ¨¡å‹ã€‚æ›´å¤šè¯¦æƒ…å¯æŸ¥çœ‹PaddleHubå®˜ç½‘ï¼šhttps://www.paddlepaddle.org.cn/hub
PaddleHubä»¥é¢„è®­ç»ƒæ¨¡å‹åº”ç”¨ä¸ºæ ¸å¿ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š
1.æ¨¡å‹å³è½¯ä»¶ï¼š é€šè¿‡Python APIæˆ–å‘½ä»¤è¡Œå®ç°æ¨¡å‹è°ƒç”¨ï¼Œå¯å¿«é€Ÿä½“éªŒæˆ–é›†æˆé£æ¡¨ç‰¹è‰²é¢„è®­ç»ƒæ¨¡å‹ã€‚
2.æ˜“ç”¨çš„è¿ç§»å­¦ä¹ ï¼š é€šè¿‡Fine-tune APIï¼Œå†…ç½®å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼Œåªéœ€å°‘é‡ä»£ç å³å¯å®Œæˆé¢„è®­ç»ƒæ¨¡å‹çš„Fine-tuningã€‚
3.ä¸€é”®æ¨¡å‹è½¬æœåŠ¡ï¼š ç®€å•ä¸€è¡Œå‘½ä»¤å³å¯æ­å»ºå±äºè‡ªå·±çš„æ·±åº¦å­¦ä¹ æ¨¡å‹APIæœåŠ¡å®Œæˆéƒ¨ç½²ã€‚
4.è‡ªåŠ¨è¶…å‚ä¼˜åŒ–ï¼š å†…ç½®AutoDL Finetunerèƒ½åŠ›ï¼Œä¸€é”®å¯åŠ¨è‡ªåŠ¨åŒ–è¶…å‚æœç´¢ã€‚

# äºŒã€å‡†å¤‡å·¥ä½œ

1ã€å¯¼å…¥åŒ…å’Œä¸¤ä¸ªæ¨¡å‹ï¼ˆå›¾åƒåˆ†ç±»å’Œæƒ…è¯ç”Ÿæˆæ¨¡å‹ï¼‰


```python
!pip install --upgrade paddlehub -i https://pypi.tuna.tsinghua.edu.cn/simple
```


```python
!hub install xception71_imagenet==1.0.0 #å›¾åƒåˆ†ç±»
!hub install ernie_gen_lover_words==1.0.1 #æƒ…è¯ç”Ÿæˆæ¨¡å‹
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/sklearn/externals/joblib/externals/cloudpickle/cloudpickle.py:47: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
      import imp
    2020-08-25 22:35:23,538-INFO: font search path ['/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/ttf', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/afm', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/pdfcorefonts']
    2020-08-25 22:35:23,864-INFO: generated new fontManager
    Downloading xception71_imagenet
    [==================================================] 100.00%
    Uncompress /home/aistudio/.paddlehub/tmp/tmpmfylo4m3/xception71_imagenet
    [==================================================] 100.00%
    Successfully installed xception71_imagenet-1.0.0
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/sklearn/externals/joblib/externals/cloudpickle/cloudpickle.py:47: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
      import imp
    Downloading ernie_gen_lover_words
    [==================================================] 100.00%
    Uncompress /home/aistudio/.paddlehub/tmp/tmpx6j5wgy0/ernie_gen_lover_words
    [==================================================] 100.00%
    Successfully installed ernie_gen_lover_words-1.0.1


**æŸ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹å›¾ç‰‡**


```python
import matplotlib.pyplot as plt 
import matplotlib.image as mpimg 

# å±•ç¤ºç¾æ™¯å›¾ç‰‡
img1 = mpimg.imread("beauty1.jpg") 

plt.figure(figsize=(10,10))
plt.imshow(img1) 
 
plt.axis('off') 
plt.show()
```


![png](output_9_0.png)


# ä¸‰ã€å…·ä½“å®ç°

1. è·å–å›¾ç‰‡çš„åˆ†ç±»ï¼Œå³è¯¥å›¾ç‰‡æ˜¯ä»€ä¹ˆ


```python
import paddlehub as hub

module_image = hub.Module(name="xception71_imagenet") # è°ƒç”¨å›¾åƒåˆ†ç±»çš„æ¨¡å‹

test_img_path = "beauty1.jpg" # é€‰æ‹©å›¾åƒï¼Œå³è¦æ ¹æ®å“ªå¼ å›¾ç‰‡å†™è¯—

# set input dict
input_dict = {"image": [test_img_path]}

# execute predict and print the result
results_image = module_image.classification(data=input_dict)

PictureClassification = list(results_image[0][0].keys())[0]
print("è¯¥å›¾ç‰‡çš„åˆ†ç±»æ˜¯ï¼š",PictureClassification) # å¾—åˆ°åˆ†ç±»ç»“æœ
```

    [32m[2020-08-25 22:50:26,659] [    INFO] - Installing xception71_imagenet module[0m
    [32m[2020-08-25 22:50:26,781] [    INFO] - Module xception71_imagenet already installed in /home/aistudio/.paddlehub/modules/xception71_imagenet[0m
    [32m[2020-08-25 22:50:27,606] [    INFO] - 638 pretrained paramaters loaded by PaddleHub[0m


    è¯¥å›¾ç‰‡çš„åˆ†ç±»æ˜¯ï¼š alp


2. è‹±æ–‡ç¿»è¯‘ä¸ºä¸­æ–‡


```python
#å¯¼å…¥ç¿»è¯‘åŒ…#
!pip install translate
```

    Looking in indexes: https://mirror.baidu.com/pypi/simple/
    Collecting translate
      Downloading https://mirror.baidu.com/pypi/packages/85/b2/2ea329a07bbc0c7227eef84ca89ffd6895e7ec237d6c0b26574d56103e53/translate-3.5.0-py2.py3-none-any.whl
    Requirement already satisfied: pre-commit in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from translate) (1.21.0)
    Collecting tox (from translate)
    [?25l  Downloading https://mirror.baidu.com/pypi/packages/a4/eb/09b02408f46cd18cc8345849dbf42a7d823ebe1cc8522517dc7b1a924ce5/tox-3.19.0-py2.py3-none-any.whl (83kB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 92kB 16.2MB/s eta 0:00:01
    [?25hRequirement already satisfied: requests in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from translate) (2.22.0)
    Collecting lxml (from translate)
    [?25l  Downloading https://mirror.baidu.com/pypi/packages/de/3c/fa420469c0d4f62ae39f19ee6505f90d00ae469f6264f4f54e61ed9d9a2c/lxml-4.5.2-cp37-cp37m-manylinux1_x86_64.whl (5.5MB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5.5MB 26.6MB/s eta 0:00:01
    [?25hRequirement already satisfied: click in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from translate) (7.0)
    Requirement already satisfied: nodeenv>=0.11.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (1.3.4)
    Requirement already satisfied: virtualenv>=15.2 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (16.7.9)
    Requirement already satisfied: cfgv>=2.0.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (2.0.1)
    Requirement already satisfied: aspy.yaml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (1.3.0)
    Requirement already satisfied: importlib-metadata; python_version < "3.8" in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (0.23)
    Requirement already satisfied: toml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (0.10.0)
    Requirement already satisfied: pyyaml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (5.1.2)
    Requirement already satisfied: identify>=1.0.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (1.4.10)
    Requirement already satisfied: six in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->translate) (1.15.0)
    Requirement already satisfied: pluggy>=0.12.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from tox->translate) (0.13.1)
    Collecting filelock>=3.0.0 (from tox->translate)
      Downloading https://mirror.baidu.com/pypi/packages/93/83/71a2ee6158bb9f39a90c0dea1637f81d5eef866e188e1971a1b1ab01a35a/filelock-3.0.12-py3-none-any.whl
    Collecting py>=1.4.17 (from tox->translate)
    [?25l  Downloading https://mirror.baidu.com/pypi/packages/68/0f/41a43535b52a81e4f29e420a151032d26f08b62206840c48d14b70e53376/py-1.9.0-py2.py3-none-any.whl (99kB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 102kB 34.0MB/s ta 0:00:01
    [?25hCollecting packaging>=14 (from tox->translate)
      Downloading https://mirror.baidu.com/pypi/packages/46/19/c5ab91b1b05cfe63cccd5cfc971db9214c6dd6ced54e33c30d5af1d2bc43/packaging-20.4-py2.py3-none-any.whl
    Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->translate) (1.25.6)
    Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->translate) (2019.9.11)
    Requirement already satisfied: idna<2.9,>=2.5 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->translate) (2.8)
    Requirement already satisfied: chardet<3.1.0,>=3.0.2 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->translate) (3.0.4)
    Requirement already satisfied: zipp>=0.5 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from importlib-metadata; python_version < "3.8"->pre-commit->translate) (0.6.0)
    Requirement already satisfied: pyparsing>=2.0.2 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from packaging>=14->tox->translate) (2.4.2)
    Requirement already satisfied: more-itertools in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from zipp>=0.5->importlib-metadata; python_version < "3.8"->pre-commit->translate) (7.2.0)
    Installing collected packages: filelock, py, packaging, tox, lxml, translate
    Successfully installed filelock-3.0.12 lxml-4.5.2 packaging-20.4 py-1.9.0 tox-3.19.0 translate-3.5.0



```python
# from translate import Translator

# translator = Translator(to_lang="chinese")
# PictureClassification_ch = translator.translate("{}".format(PictureClassification))

# print("è¯¥å›¾ç‰‡çš„åˆ†ç±»æ˜¯ï¼š",PictureClassification_ch)
```

    è¯¥å›¾ç‰‡çš„åˆ†ç±»æ˜¯ï¼š alp


alpæ˜¯é˜¿å°”å‘æ–¯å±±ï¼Œå¯è§ç¿»è¯‘ä¸å‡†ç¡®ï¼Œé‡‡ç”¨ç™¾åº¦ç¿»è¯‘APIï¼Œå¯è§https://api.fanyi.baidu.com/doc/11


```python
#ç™¾åº¦é€šç”¨ç¿»è¯‘API,ä¸åŒ…å«è¯å…¸ã€ttsè¯­éŸ³åˆæˆç­‰èµ„æºï¼Œå¦‚æœ‰ç›¸å…³éœ€æ±‚è¯·è”ç³»translate_api@baidu.com
# coding=utf-8

import http.client
import hashlib
import urllib
import random
import json

appid = ''  # å¡«å†™ä½ çš„appid
secretKey = ''  # å¡«å†™ä½ çš„å¯†é’¥

httpClient = None
myurl = '/api/trans/vip/translate'

fromLang = 'auto'   #åŸæ–‡è¯­ç§
toLang = 'zh'   #è¯‘æ–‡è¯­ç§
salt = random.randint(32768, 65536)
q= PictureClassification
sign = appid + q + str(salt) + secretKey
sign = hashlib.md5(sign.encode()).hexdigest()
myurl = myurl + '?appid=' + appid + '&q=' + urllib.parse.quote(q) + '&from=' + fromLang + '&to=' + toLang + '&salt=' + str(
salt) + '&sign=' + sign

try:
    httpClient = http.client.HTTPConnection('api.fanyi.baidu.com')
    httpClient.request('GET', myurl)

    # responseæ˜¯HTTPResponseå¯¹è±¡
    response = httpClient.getresponse()
    result_all = response.read().decode("utf-8")
    result = json.loads(result_all)

    print (result)

except Exception as e:
    print (e)
finally:
    if httpClient:
        httpClient.close()
```

    {'from': 'en', 'to': 'zh', 'trans_result': [{'src': 'alp', 'dst': 'é˜¿å°”å‘æ–¯å±±'}]}


3ã€ç”Ÿæˆæƒ…è¯


```python
PictureClassification_ch = result.get('trans_result')[0].get('dst')
module = hub.Module(name="ernie_gen_lover_words")
test_texts = []
test_texts.append(PictureClassification_ch)
results = module.generate(texts=test_texts, use_gpu=True, beam_width=5)
for result in results:
    print(result)
```

    [32m[2020-08-25 23:36:40,138] [    INFO] - Installing ernie_gen_lover_words module[0m
    [32m[2020-08-25 23:36:40,170] [    INFO] - Module ernie_gen_lover_words already installed in /home/aistudio/.paddlehub/modules/ernie_gen_lover_words[0m
    [33m[2020-08-25 23:36:48,536] [ WARNING] - use_gpu has been set False as you didn't set the environment variable CUDA_VISIBLE_DEVICES while using use_gpu=True[0m


    ['é˜¿å°”å‘æ–¯å±±ï¼Œæ˜¯æˆ‘æœ€æƒ³å»çš„åœ°æ–¹ã€‚', 'é˜¿å°”å‘æ–¯å±±ï¼Œæ˜¯æˆ‘æœ€æƒ³å»çš„åœ°æ–¹ï¼Œè‡ªä»è®¤è¯†ä½ ï¼Œæˆ‘çš„ç”Ÿæ´»å˜çš„æ— é™å®½å¹¿ï¼Œä½ æ˜¯æˆ‘æ°¸è¿œçš„çˆ±äºº!', 'é˜¿å°”å‘æ–¯å±±ï¼Œæ˜¯æˆ‘æœ€æƒ³å»çš„åœ°æ–¹ï¼Œè‡ªä»è®¤è¯†ä½ ï¼Œæˆ‘çš„ç”Ÿæ´»å˜çš„æ— é™å®½å¹¿ã€‚', 'é˜¿å°”å‘æ–¯å±±ï¼Œæ˜¯æˆ‘æœ€æƒ³å»çš„åœ°æ–¹ï¼Œè‡ªä»è®¤è¯†ä½ ï¼Œæˆ‘çš„ç”Ÿæ´»å˜çš„æ— é™å®½å¹¿ï¼Œä½ æ˜¯æˆ‘æ°¸è¿œçš„çˆ±äººã€‚', 'é˜¿å°”å‘æ–¯å±±ï¼Œæˆ‘ä¹Ÿå¾ˆæƒ³ä½ ï¼Œä½†æˆ‘ä¸ä¸‹é›¨ï¼Œæ„¿æ„é™ªä½ æ·‹é›¨ã€‚']


**å®Œ**
ï¼ˆå¸Œæœ›å°ç‹å¯ä»¥æ”¶è·çˆ±æƒ…ï¼‰
